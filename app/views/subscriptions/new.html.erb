<div data-controller="espago-iframe" class="container"
     style="max-width: 400px; margin: 40px auto; padding: 20px; box-shadow: 0 0 10px rgba(0,0,0,0.1); border-radius: 8px; background: #fff;">
  <h2 class="mb-4 text-center">Subscribe to Rubitter Red</h2>
  <p class="mb-2 text-center">
    <strong>Price:</strong> <span class="text fw-bold">$4.99 / month</span>
  </p>
  <p class="mb-3">
    <strong style="color: #9B111E;">Rubitter Red</strong> highlights your rubits and comments with a striking red border, making them stand out above others.
    Enjoy priority visibility and join the community of premium users!
  </p>
  <p class="mb-4">
    Your subscription lasts one month and will renew automatically each month unless you choose to cancel.
    We will notify you before each renewal and securely charge your saved payment method.
  </p>
  <%= form_with model: @subscription, html: { id: "subscription_form", data: { "payment-method-target": "form", "espago-iframe-target": "form" } } do |form| %>
    <%= form.submit "Subscribe Now", class: "btn btn-success btn-lg d-none", id: "process_subscription_btn", data: {
      turbo: false,
      "payment-method-target": "processBtn",
      "espago-iframe-target": "processBtn"
    } %>
  <% end %>
  <div class="d-grid mt-3">
    <a id="pay_btn" data-payment-method-target="payBtn" class="btn btn-primary btn-lg" style="text-decoration: none; cursor: pointer;">Pay</a>
  </div>
</div>
<script src="https://js.espago.com/espago-1.3.js"></script>
<script
  async
  data-id="EspagoFrameScript"
  data-key="<%= @espago_public_key %>"
  data-live="false"
  data-button="Pay"
  data-success="espagoCallback"
  src="https://js.espago.com/iframe.js"></script>
<script>
  document.addEventListener("turbo:load", function() {
      const payBtn = document.getElementById("pay_btn");

      payBtn.addEventListener("click", function(event) {
        event.preventDefault();
        if (typeof showEspagoFrame === "function") {
          showEspagoFrame();
        } else {
          alert("Payment system not ready. Please wait and try again.");
        }
      });
    });
</script>
